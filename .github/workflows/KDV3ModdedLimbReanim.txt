local roothidecf = CFrame.new(0,-255,0)





if not game.IsLoaded then
	game.Loaded:Wait()
end
local desiredmode = false

local zeropointone = 0.1
local twait = task.wait
local tspawn = task.spawn
local currentfakechar = nil
local vector3zero = Vector3.zero
local getgenv = getgenv or function()
	return _G
end

local NaN = 0/0

local dummypart = Instance.new("Part")

local GetDescendants = dummypart.GetDescendants
local IsA = dummypart.IsA
local Destroy = dummypart.Destroy

local math_random = math.random
local Vector3_new = Vector3.new

local usedefaultanims =  false

local transparency_level =  1

local disablescripts =  true

local fakecollisions =  true

local nametoexcludefromtransparency = {}

local parentrealchartofakechar = false

local respawncharacter = (function() if _G["Respawn character"] == nil then return true else return _G["Respawn character"] end end)()

local instantrespawn =true

local LocalPlayer = game:GetService("Players").LocalPlayer

	local exploit = "shitsploit"

if not LocalPlayer.Character then
	LocalPlayer.CharacterAdded:Wait()
	twait(zeropointone)
	if LocalPlayer.Character:FindFirstChildOfClass("Humanoid").RigType ~= Enum.HumanoidRigType.R6 then
		error("Script is only compatible with R6 type rigs")
		return
	end
end

local function removeAnims(character)
	if character == currentfakechar then
		return
	end
	local humanoid = character:WaitForChild("Humanoid", 5)
	local animator = humanoid:FindFirstChildWhichIsA("Animator")
	if animator then
		Destroy(animator)
	end
	local animateScript = character:FindFirstChild("Animate")
	if animateScript then
		Destroy(animateScript)
	end
	local a = nil
	a = humanoid.DescendantAdded:Connect(function(child)
		if child:IsA("Animator") then
			Destroy(child)
			a:Disconnect()
			a = nil
		end
	end)
end

LocalPlayer.CharacterAdded:Once(removeAnims)

		_G.OxideRealChar =LocalPlayer.Character
LocalPlayer.Character.Archivable = true
local originalChar = LocalPlayer.Character
local char = originalChar:Clone()
char.Name = "non"
local signaldiedbackend = LocalPlayer.ConnectDiedSignalBackend
local signalkill = LocalPlayer.Kill

if respawncharacter then
	if instantrespawn then
		if replicatesignal then
			replicatesignal(signaldiedbackend)
			twait(game.Players.RespawnTime - 0.05)
			replicatesignal(signalkill)
			LocalPlayer.CharacterAdded:Wait()
			char.Parent = workspace
			currentfakechar = char
		end
	else
		originalChar:BreakJoints()
		LocalPlayer.CharacterAdded:Wait()
		char.Parent = workspace
		currentfakechar = char
	
	end
end

twait(zeropointone)

local newChar = LocalPlayer.Character
newChar.Archivable = true

if disablescripts then
	tspawn(function()
		for _, obj in ipairs(char:GetChildren()) do
			if obj:IsA("LocalScript") then
				obj.Enabled = false
			end
		end
	end)
end

for _, part in ipairs(char:GetDescendants()) do
	if part:IsA("BasePart") or part:IsA("Decal") then
			part.Transparency = transparency_level
	end
end

twait(0.4)
	LocalPlayer.Character.Parent = char
LocalPlayer.Character = char
if parentrealchartofakechar then
	newChar.Parent = char
end
		_G.OxideRealChar =char
	
char.Humanoid.RequiresNeck = false 
char.Humanoid:SetStateEnabled(15,false) 

local newcharTorso = newChar:WaitForChild("Torso")
local fakecharTorso = char:WaitForChild("Torso")
local newcharRoot = newChar:WaitForChild("HumanoidRootPart")
local fakecharRoot = char:WaitForChild("HumanoidRootPart")

local limbmapping = {
	Neck = char:WaitForChild("Head"),
    RootJoint = char:WaitForChild("Torso"),
	["Left Shoulder"] = char:WaitForChild("Left Arm"),
	["Right Shoulder"] = char:WaitForChild("Right Arm"),
	["Left Hip"] = char:WaitForChild("Left Leg"),
	["Right Hip"] = char:WaitForChild("Right Leg")
}

local jointmapping = {
	Neck = newcharTorso:WaitForChild("Neck"),
    RootJoint = newChar.HumanoidRootPart:WaitForChild("RootJoint"),
	["Left Shoulder"] = newcharTorso:WaitForChild("Left Shoulder"),
	["Right Shoulder"] = newcharTorso:WaitForChild("Right Shoulder"),
	["Left Hip"] = newcharTorso:WaitForChild("Left Hip"),
	["Right Hip"] = newcharTorso:WaitForChild("Right Hip")
}

local function RCA6dToCFrame(Motor6D, TargetPart, ReferencePart)
    local rel = ReferencePart.CFrame:Inverse() * TargetPart.CFrame
    local delta = Motor6D.C0:Inverse() * rel * Motor6D.C1
    local axis, angle = delta:ToAxisAngle()
    local newangle = axis * angle
	local offset = Vector3.zero 
	if TargetPart:FindFirstChildOfClass("SpecialMesh") then 
		offset = TargetPart:FindFirstChildOfClass("SpecialMesh").Offset
	end
    sethiddenproperty(Motor6D, 'ReplicateCurrentOffset6D', delta.Position + offset)
    sethiddenproperty(Motor6D, 'ReplicateCurrentAngle6D', newangle)
end

local ToObjectSpace = CFrame.new().ToObjectSpace
local ToEulerAnglesXYZ = CFrame.new().ToEulerAnglesXYZ
local task_spawn = task.spawn
local function stepReanimate()
    --// YES the code is badly formatted YES the code barely works
    --// YES it is unstable. im working on a fix.
	for joint, limb in pairs(limbmapping) do
		   local realJoint = jointmapping[joint]
		   	realJoint.MaxVelocity = 9e9
	end
task_spawn(function()


for joint, limb in pairs(limbmapping) do
    newcharRoot.CFrame = roothidecf + Vector3_new(0, 0, math_random(1, 2) / 326.19)
    newcharRoot.Velocity = vector3zero
    newcharRoot.RotVelocity = vector3zero
			local relativecframe = ToObjectSpace(limb.CFrame, fakecharTorso.CFrame)
	local pitch, yaw, _ = ToEulerAnglesXYZ(relativecframe)
	local angle = 0

	if joint == "Neck" then
		angle = -yaw
	elseif joint == "Left Shoulder" or joint == "Left Hip" then
		angle = pitch
	elseif joint == "Right Shoulder" or joint == "Right Hip" then
		angle = -pitch
	end
    local realJoint = jointmapping[joint]
	
	 realJoint:SetDesiredAngle(angle)
		realJoint.MaxVelocity = 9e9
    if joint == "RootJoint" then
RCA6dToCFrame(realJoint, fakecharTorso, newcharTorso)
else
	 if desiredmode == false then 
RCA6dToCFrame(realJoint, limb, fakecharTorso)
    end
end
end



end)
end


local function setdestroyheight(height)
	local sucess, result = pcall(function()
		workspace.FallenPartsDestroyHeight = height
	end)
	if not sucess then
	end
end

local currentheight = workspace.FallenPartsDestroyHeight

local function flinginternal(character, time)
	local time = time or 5

	flinging = true
	local start = tick()
	local connection
	connection = game:GetService("RunService").Heartbeat:Connect(function()
		if tick() - start >= time then
			setdestroyheight(currentheight)
			flinging = false
			connection:Disconnect()
			--break
		end
		if character then
			if character:FindFirstChild("HumanoidRootPart") then
				local velocity = character.HumanoidRootPart.Velocity
				local direction = velocity.Magnitude > 1 and velocity.Unit or Vector3_new(0, 0, 0)
				local predictedPosition = (character.PrimaryPart.CFrame or character.HumanoidRootPart.CFrame).Position + direction * math_random(5, 12)

				newcharRoot.CFrame = CFrame.new(predictedPosition)
				newcharRoot.Velocity = Vector3_new(9e7, 9e7 * 10, 9e7)
				newcharRoot.RotVelocity = Vector3_new(9e8, 9e8, 9e8)
			else
				flinging = false
				connection:Disconnect()
				--break
			end
		else
			flinging = false
			connection:Disconnect()
			--break
		end
	end)

end

getgenv().fling = function(character, time, yield)
	setdestroyheight(NaN)
	local yield = yield or false
	if yield then
		flinginternal(character, time)
	else
		tspawn(flinginternal, character, time)
	end
end

local function disableCollisions()
	pcall(function()
		for _, char in ipairs({ newChar }) do
			for _, obj in ipairs(GetDescendants(char)) do
				if IsA(obj, "BasePart") then
					obj.CanCollide = false
					obj.Massless = true
				end
			end
		end
	end)
end

local function disableCollisionsWithFakeChar()
	pcall(function()
		for _, char in ipairs({ newChar, char }) do
			for _, obj in ipairs(GetDescendants(char)) do
				if IsA(obj, "BasePart") then
					obj.CanCollide = false
					obj.Massless = true
				end
			end
		end
	end)
end

local RunService = game:GetService("RunService")

RunService.Heartbeat:Connect(stepReanimate)

local humanoidnewchar = newChar:WaitForChild("Humanoid")

humanoidnewchar.PlatformStand = true
humanoidnewchar.AutoRotate = false

if fakecollisions then
	RunService.PreSimulation:Connect(disableCollisions)
else
	RunService.PreSimulation:Connect(disableCollisionsWithFakeChar)
end

workspace.CurrentCamera.CameraSubject = char:WaitForChild("Humanoid")

finished = true


local uis = game:GetService("UserInputService")
uis.InputBegan:Connect(function(k,chatting)
	if chatting then return end
if k.KeyCode == Enum.KeyCode.Comma then 
desiredmode = not desiredmode
elseif k.KeyCode == Enum.KeyCode.Minus then 
    roothidecf = fakecharRoot.CFrame
end
end) 
newcharRoot.Transparency = 0.5
	local speaker = game:GetService("Players").LocalPlayer
	local Players = game:GetService("Players")
	local RunService = game:GetService("RunService")
	antifling = RunService.Stepped:Connect(function()
		for _, player in pairs(Players:GetPlayers()) do
			if player ~= speaker and player.Character then
				for _, v in pairs(player.Character:GetDescendants()) do
					if v:IsA("BasePart") then
						v.CanCollide = false
					end
				end
			end
		end
	end)
	local seatdebounce = 3 
local cansit = true 
	char:FindFirstChild("Left Leg").Touched:Connect(function(p)
    if p:IsA("Seat") and cansit == true then 
        local sw = Instance.new("Weld",p)
        sw.Name = "SeatWeld"
        sw.Part0 = p 
        sw.Part1 = char:FindFirstChild("HumanoidRootPart")
        sw.C0 = CFrame.new(0, 0.2, 0, 1, 0, -0, 0, 0, 1, 0, -1, 0)
        sw.C1 = CFrame.new(0, -1.5, 0, 1, 0, -0, 0, 0, 1, 0, -1, 0)
         char:FindFirstChildOfClass("Humanoid").Sit = true
        char:FindFirstChildOfClass("Humanoid").Jumping:Wait()
        sw:Destroy()
         char:FindFirstChildOfClass("Humanoid").Sit = false 
         cansit = false
         task.spawn(function()
             task.wait(seatdebounce)
             cansit = true 
             end)
    end 
	end) 
 pcall(function()
     char.ForceField:Destroy()
 end)
  pcall(function()
     char.OverheadGUI:Destroy()
 end)
getgenv().iSaidEpic = true
task.wait(10)
-- Krystal Dance V3, Made by Hemi (May you have a good life, hemi.)
-- Crimson is now the respective owner of oxide. 
if not isfolder("Dances") then 
    makefolder("Dances")
    end
local lol = math.random(1,30)
if lol == 2 then 
lol = true 
end
local sprinting = false 
local is = game:GetService("InsertService")
local idleanim = is:LoadLocalAsset("rbxassetid://136078657506707")
local walkanim = is:LoadLocalAsset("rbxassetid://130213485744288")
local sprintanim = is:LoadLocalAsset("rbxassetid://119558526211035")
local randompart = Instance.new("Part",game:GetService("RunService"))
local coolparticles = is:LoadLocalAsset("rbxassetid://87299663038091").ParticleAttachment
coolparticles.Parent = randompart
local playbacktrack = true 
local script = Instance.new("LocalScript")
getgenv().mod = true
local OxideApi = loadstring(game:HttpGet("https://raw.githubusercontent.com/sparezirt/Utility/refs/heads/main/.github/SonixApi"))()
local timeposcur = 0 
OxideApi.Notification("Krystal Dance Modded V1 by Sonixery, Full Credits to Crimson",10)
local playanother = false
local playing = false
local dancing = false
local rtrnv;
local c;
local tbl3;
local v;
local anim;
local count;
local hhhh;
local asdf;
local s;
local animid;
local plr;
local char=game:GetService("Players").LocalPlayer.Character
local hum=char:FindFirstChildOfClass("Humanoid")
local h=char.Head
local t=char.Torso
local hrp=char.HumanoidRootPart 
local cframe;
local torso;
local rs;
local ls;
local rh;
local lh;
local n;
local rj;
local rsc0;
local lsc0;
local rhc0;
local lhc0;
local rjc0;
local nc02;
local gc0;
local orsc0;
local olsc0;
local orhc0;
local olhc0;
local orjc0;
local onc0;
local count2;
local maxcount2;
local walking = false
local idle = false
local RunService = game:GetService("RunService")
local function getnext(tbl,number)
	c=100
	rtrnv=0
	for i,v in pairs(tbl) do
		if i>number and i-number<c then
c=i-number
rtrnv=i
		end
	end
	return(rtrnv)
end
local function wait2(tim)
	if tim<0.1 then
		game:GetService("RunService").Heartbeat:Wait()
	else
		for i=1,tim*40 do
game:GetService("RunService").Heartbeat:Wait()
		end
	end
end
local function kftotbl(kf) -- Below this is literal pain..
	tbl3 = {}
	for i,v in pairs(kf:GetDescendants()) do
		if v:IsA("Pose") then
tbl3[string.sub(v.Name,1,1)..string.sub(v.Name,#v.Name,#v.Name)] = v.CFrame
		end
	end
	return(tbl3)
end
local sound69 = Instance.new("Sound",game:GetService("RunService"))
sound69.Looped = true
sound69.Name = "danc"
sound69.Playing = true
sound69.Volume = .75
local plr = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

local function functionToBind()
    char.Humanoid:Move(Vector3.new(0,0,-1),false)
end
local script = Instance.new("Script")
ArtificialHB = Instance.new("BindableEvent",script)
ArtificialHB.Name = "Heartbeat"
script:WaitForChild("Heartbeat")
frame = 1 / 60
tf = 0
allowframeloss = false
tossremainder = false
lastframe = tick()
script.Heartbeat:Fire()
game:GetService("RunService").Heartbeat:Connect(function(s,p)
   tf = tf + s
   if tf >= frame then
	   if allowframeloss then
		   script.Heartbeat:Fire()
		   lastframe = tick()
	   else
		   for i = 1,math.floor(tf / frame) do
			pcall(function()
			   script.Heartbeat:Fire()
			end)
		   end
		   lastframe = tick()
	   end
	   if tossremainder then
		   tf = 0
	   else
		   tf = tf - frame * math.floor(tf / frame)
	   end
   end
end)
function swait(num)
   if num == 0 or num == nil then
	   ArtificialHB.Event:Wait()
   else
	   for i = 0,num do
		   ArtificialHB.Event:Wait()
	   end
   end
end

			function fwait(seconds)
				seconds = (seconds < 0.000001) and 0.000001 or seconds -- absolute limit of roblox, anything below just crashes lol so this limits it so it doesnt crash
			
				local event = game:GetService("RunService").PreRender or game:GetService("RunService").Heartbeat
			
				local startTime = tick()
				while tick() - startTime < seconds do
					event:Wait()
				end
			end		
            local legitjustran = false
            local loopsplaying=0 
            local rst 
            local lst
            local rht 
            local lht 
            local nt 
            local rjt
	local function playanim(id,speed,isadance,custominstance)
        playanother = true 
        loopsplaying+=1
        if legitjustran == true then return end
        legitjustran = true 
        if isadance == nil then 
            isadance = true 
        end
        if isadance == true  then 
            sound69.Volume =0
        end
        if dancing == true then 
            sound69:Play()
            sound69.TimePosition = 0
           end
        if dancing == true then 
            walking = false
            idle = false
           end
		if speed == nil then 
			speed = 1
		end
        if dancing == true then 
            idle = false 
            char.Humanoid:Move(Vector3.new(0,0,-1),true)
            walking = false 
        end
        wait(.005)
        if isadance == true  then 
            sound69.Volume =2 
        end
        if dancing == true then 
            sound69:Play()
            sound69.TimePosition = 0
           end
        legitjustran = false
        playanother = false 
   
        local animid="rbxassetid://"..id
   char = char
   pcall(function()
       hhhh=char.Humanoid.Animator
   hhhh.Parent = nil
   end)
   for _,v in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
       v:Stop()
   end
   cframe = char.HumanoidRootPart.CFrame
   torso = char.Torso
   -----------------------------------------------------------
   local ts = game:GetService("TweenService")
   local tsi = TweenInfo.new(1/(30*speed))
   rs = torso["Right Shoulder"] -- Just took this from another script(Faster).
   ls = torso["Left Shoulder"]
   rh = torso["Right Hip"]
   lh = torso["Left Hip"]
   n = torso["Neck"]
   rj = char.HumanoidRootPart["RootJoint"]
   rsc0 = rs.C0
   lsc0 = ls.C0
   rhc0 = rh.C0
   lhc0 = lh.C0
   rjc0 = rj.C0
   nc02 = n.C0
   gc0 = CFrame.new()
   orsc0 = rs.C0
   olsc0 = ls.C0
   orhc0 = rh.C0
   olhc0 = lh.C0
   orjc0 = rj.C0
   onc0 = n.C0
   count2 = 100
   maxcount2=100
   playanother = false
   frame = 1 / (30*speed)
	if custominstance == nil then
     animid=is:LoadLocalAsset(animid)
	else
		animid = custominstance
	end
    animid.Parent = workspace
     local anim={}
   for i,v in pairs(animid:GetChildren()) do
       if v:IsA("Keyframe") then
           anim[v.Time]=kftotbl(v)
       end
   end
   
   count = 0
   char=char
   if dancing == true then 
    sound69:Play()
    sound69.TimePosition = 0
   end
   plr.CharacterRemoving:Connect(function()
       if playing == true then
           playing = false
       end
   end)
   while true do
    print(loopsplaying)
    if loopsplaying>1 then 
        break
    end
       if playanother == true then
           local deft = CFrame.new(0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1)
           rs.Transform = deft
           ls.Transform = deft
           lh.Transform = deft
           rj.Transform = deft
           n.Transform  = deft
           rh.Transform = deft  
           pcall(function()
            rst:Cancel()
            rht:Cancel()
            lht:Cancel()
            lst:Cancel()
            nt:Cancel()
            rjt:Cancel()
        end)

           break
       else
           for i,oasjdadlasdkadkldjkl in pairs(anim) do
  local asdf=getnext(anim,count)
 local  v=anim[asdf]
   if playanother == true then
       local deft = CFrame.new(0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1)
       rs.Transform = deft
       ls.Transform = deft
       lh.Transform = deft
       rj.Transform = deft
       n.Transform  = deft
       rh.Transform = deft  
       pcall(function()
        rst:Cancel()
        rht:Cancel()
        lht:Cancel()
        lst:Cancel()
        nt:Cancel()
        rjt:Cancel()
    end)
       break
   end
   if walking == true and char.Humanoid.MoveDirection == Vector3.new(0,0,0) then 
    break 
   end
   frame = 1 / (30*speed)
   if dancing == true and isadance == false then 
    break 
   end
   if dancing == true then 
    walking = false
    idle = false
   end
   if walking == true and idle == true then 
    playanother = true 
   end
   if v["Lg"] then
       lhc0 = v["Lg"]
   end
   if v["Rg"] then
       rhc0 = v["Rg"]
   end
   if v["Lm"] then
       lsc0 = v["Lm"]
   end
   if v["Rm"] then
       rsc0 = v["Rm"]
   end
   if v["To"] then
       rjc0 = v["To"]
   end
   if v["Hd"] then
       nc02 = v["Hd"]
   end
   count2=0
   maxcount2=asdf-count
   count=asdf
    swait(1/(30*speed))
   if playanother == true then
    local deft = CFrame.new(0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1)
    rs.Transform = deft
    ls.Transform = deft
    lh.Transform = deft
    rj.Transform = deft
    n.Transform  = deft
    rh.Transform = deft  
    pcall(function()
        rst:Cancel()
        rht:Cancel()
        lht:Cancel()
        lst:Cancel()
        nt:Cancel()
        rjt:Cancel()
    end)
    break
    end
   count2=maxcount2
   if v["Lg"] then
	lht = ts:Create(char.Torso["Left Hip"],tsi,{Transform = CFrame.new(v["Lg"].p*char:GetScale())*v["Lg"].Rotation}):Play()
      -- char.Torso["Left Hip"].Transform = CFrame.new(v["Lg"].p*char:GetScale())*v["Lg"].Rotation
   end
   if v["Rg"] then
	rht = ts:Create(char.Torso["Right Hip"],tsi,{Transform = CFrame.new(v["Rg"].p*char:GetScale())*v["Rg"].Rotation}):Play()
    --   char.Torso["Right Hip"].Transform = CFrame.new(v["Rg"].p*char:GetScale())*v["Rg"].Rotation
   end
   if v["Lm"] then
	lst = ts:Create(char.Torso["Left Shoulder"],tsi,{Transform = CFrame.new(v["Lm"].p*char:GetScale())*v["Lm"].Rotation}):Play()
     --  char.Torso["Left Shoulder"].Transform =  CFrame.new(v["Lm"].p*char:GetScale())*v["Lm"].Rotation
   end
   if v["Rm"] then
	rst = ts:Create(char.Torso["Right Shoulder"],tsi,{Transform = CFrame.new(v["Rm"].p*char:GetScale())*v["Rm"].Rotation}):Play()
      -- char.Torso["Right Shoulder"].Transform = CFrame.new(v["Rm"].p*char:GetScale())*v["Rm"].Rotation
   end
   if v["To"] then
	rjt = ts:Create(char.HumanoidRootPart["RootJoint"],tsi,{Transform = CFrame.new(v["To"].p*char:GetScale())*v["To"].Rotation}):Play()
      -- char.HumanoidRootPart["RootJoint"].Transform = CFrame.new(v["To"].p*char:GetScale())*v["To"].Rotation
   end
   if v["Hd"] then
	nt = ts:Create(char.Torso["Neck"],tsi,{Transform = CFrame.new(v["Hd"].p*char:GetScale())*v["Hd"].Rotation}):Play()
       --char.Torso["Neck"].Transform =  CFrame.new(v["Hd"].p*char:GetScale())*v["Hd"].Rotation
   end
           end
       end
   end
           end   
           local exploit = "shitsploit"
        pcall(function()
            exploit = getexecutorname()
        end)
	local customasset = function(id)
        if exploit ~= "CaetSploit" then
        idwithoutthatbit= string.gsub(id,"Dances/","")
        if not isfile(id) then 
         writefile(id,game:HttpGet("https://github.com/sparezirt/music/raw/refs/heads/main/"..idwithoutthatbit))
        end
       repeat task.wait() until isfile(id)
    end
        local s = Instance.new("Sound")
        s.Parent = game:GetService("RunService")
        s.SoundId = getcustomasset(id)
        task.spawn(function()
            task.wait(1)
            s:Destroy()
        end)
        return s.SoundId
    end
           local function stopanim()
           if loopsplaying>0 then 
                loopsplaying-=1
           end
            playanother = true 
            playanother = true 
            playanother = true 
            playanother = true 
            sound69.PlaybackSpeed = 1
            if playbacktrack == true then 
                           if lol ~= true then 
            sound69.SoundId = customasset("Dances/ElevatorMusic.mp3")
                else 
                      sound69.SoundId = customasset("Dances/ElevatorMusic.mp3")  
                end
            sound69.Volume = .75
            else 
                sound69:Stop()
            end
            coolparticles.Parent = randompart
            pcall(function()
                rst:Cancel()
                rht:Cancel()
                lht:Cancel()
                lst:Cancel()
                nt:Cancel()
                rjt:Cancel()
            end)
            if dancing == true then 
                sound69.TimePosition = timeposcur
                dancing = false
                idle = true 
                char.Humanoid:Move(Vector3.new(0,0,-1),true)
                walking = false 
                wait(.065)
                if walking == true and idle == false and  char.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and dancing == false and playanother==true  then 
                task.spawn(function()
                playanim(136078657506707,1,false)
                end)
            end
            end
                    end
local mode = 1 


local INPUTLOOP 
local uis = game:GetService("UserInputService")
INPUTLOOP = uis.InputBegan:Connect(function(k,chatting)
	if char.Humanoid.Sit == true then return end
    if chatting then return end 
        local k = string.lower(string.gsub(tostring(k.KeyCode),"Enum.KeyCode.",""))
	if mode == 1 then 
	if k == "q" then 
		if dancing == false then 
            stopanim()
dancing = true
task.wait(.005)
		    sound69.SoundId = customasset("Dances/rat.mp3")
		    timeposcur = sound69.TimePosition 
sound69:Play()
		    playanim(106353328250763)
		else
	        stopanim()
		end
	elseif k == "e" then 
		if dancing == false then 
stopanim()
dancing = true
task.wait(.005)
sound69.SoundId = customasset("Dances/boogie.mp3")
sound69.PlaybackSpeed = 2
timeposcur = sound69.TimePosition 
sound69:Play()
playanim(16769959846)
		else
stopanim()
sound69.PlaybackSpeed = 1

end
		elseif k == "r" then 
if dancing == false then 
	stopanim()
dancing = true
task.wait(.005)
	sound69.SoundId = customasset("Dances/RatDance.mp3")
	sound69.PlaybackSpeed = 1
	timeposcur = sound69.TimePosition 
sound69:Play()
	playanim(128853270774115)
else
	stopanim()
	sound69.PlaybackSpeed = 1
	
	end
elseif k == "t" then 
	if dancing == false then 
		stopanim()
dancing = true
task.wait(.005)
		sound69.SoundId = customasset("Dances/ScoutLaugh.mp3")
		sound69.PlaybackSpeed = 1
		timeposcur = sound69.TimePosition 
sound69:Play()
		playanim(13845017130)
	else
		stopanim()
		sound69.PlaybackSpeed = 1
		
		end
	elseif k == "y" then 
		if dancing == false then 
stopanim()
dancing = true
task.wait(.005)
sound69.SoundId = customasset("Dances/sturdy.mp3")
sound69.PlaybackSpeed = 1
timeposcur = sound69.TimePosition 
sound69:Play()
playanim(100864643591096)
		else
stopanim()
sound69.PlaybackSpeed = 1

end
    elseif k == "u" then 
if dancing == false then 
    stopanim()
dancing = true
task.wait(.005)
    sound69.SoundId = customasset("Dances/caramell.mp3")
    sound69.PlaybackSpeed = 1
    timeposcur = sound69.TimePosition 
sound69:Play()
    playanim(103597509139287)
else
    stopanim()
    sound69.PlaybackSpeed = 1
    
 end
elseif k == "f" then 
    if dancing == false then 
        stopanim()
dancing = true
task.wait(.005)
        sound69.SoundId = customasset("Dances/order.mp3")
        sound69.PlaybackSpeed = 2
        char.Humanoid.WalkSpeed = 4*char:GetScale()
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(130968726197789)
    else
        stopanim()
        
    end
elseif k == "g" then 
    if dancing == false then 
        stopanim()
dancing = true
task.wait(.005)
        sound69.SoundId = customasset("Dances/gangnamm.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(12438774071)
    else
        stopanim()
        
    end
elseif k == "p" then 
    if dancing == false then 
        stopanim()
dancing = true
task.wait(.005)
        sound69.SoundId = customasset("Dances/MioHonda.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(97072681531610)
    else
        stopanim()
        
    end
elseif k == "j" then 
    if dancing == false then 
        stopanim()
dancing = true
task.wait(.005)
        sound69.SoundId = customasset("Dances/groove.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(75462948983147)
    else
        stopanim()
        
    end
elseif k == "k" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Kumar.mp3")
        char.Humanoid.WalkSpeed = 0*char:GetScale()
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(123466997748392)
    else
        char.Humanoid.WalkSpeed = 0*char:GetScale()
        stopanim()
        
    end
elseif k == "l" then 
    if dancing == false then 
        stopanim()
    dancing = true
    task.wait(.005)
        sound69.SoundId = customasset("Dances/Conga.mp3")
        char.Humanoid.WalkSpeed = 4*char:GetScale()
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(18985751348)
    else
        char.Humanoid.WalkSpeed = 14*char:GetScale()
        stopanim()
        
    end
elseif k == "z" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/PokeDance.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(18986687692)
    else
        stopanim()
        
    end
elseif k == "x" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/kazot.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(114036336168567,1)
    else
        stopanim()
        
    end
elseif k == "h" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Mailbox.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(12843537499,0.75)
    else
        stopanim()
        
    end
elseif k == "v" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/HakariDance4K.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(92699725136780)
    else
        stopanim()
        
    end

elseif k == "c" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/HeelToeTopRock.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(140670228658366)
    else
        stopanim()
        
    end
elseif k == "n" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/ColorYourNight.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(75405139558088,0.75)
    else
        stopanim()
        
    end

                    elseif k == "comma" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Mystery.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131401099812672)
    else
        stopanim()
        
    end
elseif k == "leftbracket" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Lagtrain.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131559207454945)
    else
        stopanim()
        
    end
elseif k == "quote" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Rewind.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(140376973204352)
    else
        stopanim()
        
    end

                                end
                                end
if mode == 2 then 
    if k == "q" then 
           if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/XO.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(73559770055600)
    else
        stopanim()
        
           end 
    elseif k == "e" then
                     if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/ElevatorMusic2.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(16361576857)
    else
        stopanim()
        
                     end 
           elseif k == "r" then
                     if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/freeflow.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(101564911432113)
    else
        stopanim()
        
                     end 
           elseif k == "t" then 
          if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/kemusan.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(124210157097622)
    else
        stopanim()
        
          end
           elseif k == "y" then 
          if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/balls.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(15039779727)
    else
        stopanim()
        
    end
elseif k == "h" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/faster.ogg")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(10609437925)
    else
        stopanim()
        
    end
elseif k == "g" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/tryna.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(14887006269)
    else
        stopanim()
        
    end
                                elseif k == [[f]] then 
                                    if dancing == false then 
                                        stopanim()
                                        dancing = true
                                        task.wait(.005)
                                        sound69.SoundId = customasset("Dances/HellToeTop.mp3")
                                        timeposcur = sound69.TimePosition 
sound69:Play()
                                        playanim(98256622649150)
                                    else
                                        stopanim()
                                        
                                    end
elseif k == "j" then 
    if dancing == false then 
stopanim()
dancing = true
task.wait(.005)
sound69.SoundId = customasset("Dances/AffectedFight.mp3")
sound69.PlaybackSpeed = 1
timeposcur = sound69.TimePosition 
sound69:Play()
coolparticles.Parent = char.Torso
playanim(118865990558686)
    else
stopanim()
sound69.PlaybackSpeed = 1

end
                                elseif k == "k" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Laidback.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131155721688011)
    else
        stopanim()
        
    end
elseif k == "u" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/bloodpop.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(111038494387073)
    else
        stopanim()
        
    end
elseif k == "n" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        playanim(90819860436349)
    else
        stopanim()
        
    end
elseif k == "z" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/leftright.mp3")
        timeposcur = sound69.TimePosition 
        sound69:Play()
        playanim(137845929482571)
    else
        stopanim()
        
    end    
elseif k == "x" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/heavylove.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(85856686932206)
    else
        stopanim()
        
    end
elseif k == "c" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/million.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(109123683211464)
    else
        stopanim()
    end
elseif k == "v" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/StockDance.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(15039780593)
    else
        stopanim()
    end
elseif k == "p" then
    if dancing == false then
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/DanceofNights.mp3")
        timeposcur = sound69.TimePosition
        sound69:Play()
        playanim(13456829762)
    else
        stopanim()

    end
elseif k == "l" then
    if dancing == false then
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/secret.mp3")
        timeposcur = sound69.TimePosition
        sound69:Play()
        playanim(105416804363388,18/30)
    else
        stopanim()

    end
                    elseif k == "comma" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/phonkyturn.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(89046713686252,3)
    else
        stopanim()
        
    end
elseif k == "leftbracket" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/true_heart.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131776726113292)
    else
        stopanim()
        
    end
elseif k == "quote" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Rewind.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(140376973204352)
    else
        stopanim()
        
    end
        end 
    elseif mode == 3 then 
if k == "q" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/crisscross.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(73116243097694)
    else
        stopanim()
    end
elseif k == "e" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/brain.mp3")
        char.Humanoid.WalkSpeed = 4*char:GetScale()
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(86485871533985)
    else
        stopanim()
    end
elseif k == "r" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/duck.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(13357063395,1,true,nil,false)
    else
        stopanim()
    end
elseif k == "t" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/espresso.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(87342159331194)
    else
        stopanim()
    end
elseif k == "y" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/rakuten.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(18985726113)
    else
        stopanim()
    end
elseif k == "u" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/bimbam.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(16361564081)
    else
        stopanim()
    end
    elseif k == "f" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/tort.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(79630525228564)
    else
        stopanim()
    end
elseif k == "g" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/lemon.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(120262284704633,.8)
    else
        stopanim()
    end
    elseif k == "h" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/boom.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(84471848998012)
    else
        stopanim()
    end
    elseif k == "j" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/doodle.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(137721173051346)
    else
        stopanim()
    end
          elseif k == "k" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/hypno.mp3")
        timeposcur = sound69.TimePosition  
sound69:Play()
        playanim(72723551972407)
    else
        stopanim()
    end
            elseif k == "z" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Assumptions.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(75148929064618)
    else
        stopanim()
    end
                elseif k == "x" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/rotten.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(109990576374190,2)
    else
        stopanim()
    end
                elseif k == "c" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/danceifyourethegoat.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(80641587562132,2)
    else
        stopanim()
    end
                    elseif k == "v" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/misc.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(100305033962391,2)
    else
        stopanim()
    end
                        elseif k == "n" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/jung.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(71723925114737)
    else
        stopanim()
    end
elseif k == "p" then
    if dancing == false then
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/pogo.mp3")
        timeposcur = sound69.TimePosition
        sound69:Play()
        playanim(8829798048,1.5)
    else
        stopanim()

    end
elseif k == "l" then
    if dancing == false then
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/CarShearer.mp3")
        timeposcur = sound69.TimePosition
        sound69:Play()
        playanim(82286209518466,1.95)
    else
        stopanim()

    end
                    elseif k == "comma" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Mystery.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131401099812672)
    else
        stopanim()
        
    end
elseif k == "leftbracket" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/true_heart.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(131776726113292)
    else
        stopanim()
        
    end
elseif k == "quote" then 
    if dancing == false then 
        stopanim()
        dancing = true
        task.wait(.005)
        sound69.SoundId = customasset("Dances/Rewind.mp3")
        timeposcur = sound69.TimePosition 
sound69:Play()
        playanim(140376973204352)
    else
        stopanim()
        
    end
        end 
end
if k == "equals" then 
    playbacktrack = not playbacktrack
    if dancing == false then 
    if playbacktrack == true then 
        sound69:Play()
        sound69.Volume = .75
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Krystal Dance V3";
            Duration = 5;
            Text = "Background music enabled"
        })
    else 
    sound69:Stop()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Krystal Dance V3";
        Duration = 5;
        Text = "Background music disabled"
    })
    end
    end
end
if k == "leftcontrol" then 
    sprinting = not sprinting
end
if k == "m" then 
    if mode == 2 then 
    mode = 3
    game:GetService("StarterGui"):SetCore("SendNotification", {
	Title = "Krystal Dance V3";
	Duration = 5;
	Text = "You are on page 3"
})
elseif mode == 1 then
        mode = 2 
    game:GetService("StarterGui"):SetCore("SendNotification", {
	Title = "Krystal Dance V3";
	Duration = 5;
	Text = "You are on page 2"
})
elseif mode ==3 then 
    mode = 1
    game:GetService("StarterGui"):SetCore("SendNotification", {
	Title = "Krystal Dance V3";
	Duration = 5;
	Text = "You are on page 1"
})
    end
    end
end)
char.Humanoid:GetPropertyChangedSignal("MoveDirection"):Connect(function()
	if char.Humanoid.Sit == false then 
    if char.Humanoid.MoveDirection == Vector3.new(0,0,0) and dancing == false and idle == false then
    walking = false
    idle = true
	stopanim()
	fwait(1/500)
        if idle == true and walking == false and char.Humanoid.MoveDirection == Vector3.new(0,0,0) and dancing == false and playanother==true then
            playanim(0,1,false,idleanim )
            end
        elseif char.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and dancing == false and walking == false then 
            char.Humanoid.WalkSpeed = 14*char:GetScale()
            walking = true
            idle = false
            stopanim()
            fwait(1/500)
    	 if sprinting == false then 
                 char.Humanoid.WalkSpeed = 14*char:GetScale()
            if walking == true and idle == false and  char.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and dancing == false and playanother==true  then 
                playanim(130213485744288,1,false,walkanim)
            end
        else
                char.Humanoid.WalkSpeed = 24*char:GetScale()
            if walking == true and idle == false and  char.Humanoid.MoveDirection ~= Vector3.new(0,0,0) and dancing == false and playanother==true  then 
                playanim(130213485744288,2.2,false,sprintanim)
            end
    end
end
end
    end)
	char.Humanoid:GetPropertyChangedSignal("Sit"):Connect(function()
		print("sit")
		if char.Humanoid.Sit == true then 
			stopanim()
			
			math.randomseed(os.clock())
			if math.random(1,2) == 1 then 
			playanim(133312100962627,1,false)
			else 
			playanim(122775909441631,1,false)
			end
		else 
			stopanim()
			task.wait(.05)
			stopanim()
			char.Humanoid:Move(Vector3.new(0,0,-1),true)
			char.Humanoid:Move(Vector3.new(0,0,-1),true)
			char.Humanoid:Move(Vector3.new(0,0,-1),true)
		end
	end)

local RunService = game:GetService("RunService")

local Player = game:GetService("Players").LocalPlayer
local PlayerMouse = Player:GetMouse()
local Camera = workspace.CurrentCamera
local Character =char

local Humanoid = Character:WaitForChild("Humanoid")
local IsR6 = (Humanoid.RigType == Enum.HumanoidRigType.R6)

local Head = Character:WaitForChild("Head")
local Torso = if IsR6 then Character:WaitForChild("Torso") else Character:WaitForChild("UpperTorso")

local Neck = if IsR6 then Torso:WaitForChild("Neck") else Head:WaitForChild("Neck")
local Waist = if IsR6 then nil else Torso:WaitForChild("Waist")

local NeckOriginC0 = Neck.C0
local WaistOriginC0 = if Waist then Waist.C0 else nil

Neck.MaxVelocity = 1/3

local AllowedStates = {Enum.HumanoidStateType.Running, Enum.HumanoidStateType.Climbing, Enum.HumanoidStateType.Swimming, Enum.HumanoidStateType.Freefall, Enum.HumanoidStateType.Seated}
local IsAllowedState = (table.find(AllowedStates, Humanoid:GetState()) ~= nil)

local find = table.find
local atan = math.atan
local atan2 = math.atan2

Humanoid.StateChanged:Connect(function(_, new)
	IsAllowedState = (find(AllowedStates, new) ~= nil)
end)
local oldC0N = Neck.C0

local updatesPerSecond = 10
local Character = char 
local Root = char.HumanoidRootPart
introsound = Instance.new("Sound",Root)
introsound.SoundId = "rbxassetid://236146895"
introsound.Volume = 2
introsound:Play()

bigfedora = Instance.new("Part",Character)
bigfedora.Size = Vector3.new(2,2,2)
bigfedora.CFrame = bigfedora.CFrame:inverse() * Root.CFrame * CFrame.new(math.random(-60,60),-.2,math.random(-60,60)) * CFrame.Angles(0,math.rad(math.random(-180,180)),0)
bigfedora.CanCollide = false
bigfedora.Anchored = true
bigfedora.Name = "mbigf"
mbigfedora = Instance.new("SpecialMesh", bigfedora)
mbigfedora.MeshType = "FileMesh"
mbigfedora.Scale = Vector3.new(5, 5, 5)
mbigfedora.MeshId,mbigfedora.TextureId = 'http://www.roblox.com/asset/?id=1125478','http://www.roblox.com/asset/?id=1125479'

for i = 1, 60 do
bigfedora.CFrame = bigfedora.CFrame:lerp(CFrame.new(Root.Position) * CFrame.new(0,-.1,0) * CFrame.Angles(math.rad(0),math.rad(0),math.rad(0)),.09)
task.wait(1/60)
end
wait(.25)
for i = 1, 50 do
bigfedora.CFrame = bigfedora.CFrame:lerp(CFrame.new(char.Head.Position),.05)
task.wait(1/60)
end
zmc = 0
for i = 1, 29 do
zmc = zmc + 2
mbigfedora.Scale = mbigfedora.Scale - Vector3.new(.25,.25,.25)
bigfedora.CFrame = bigfedora.CFrame * CFrame.Angles(math.rad(0),math.rad(zmc),0)
task.wait(1/60)
end
bigfedora:Remove()
local nim= 0
char.Humanoid.Died:Connect(function()
sound69.PlaybackSpeed = 0
sound69.Parent = nil 
sound69.Volume = 0
end)
local hum = char.Humanoid
local cf = CFrame.new
local DIEDLOOP 
local HEADLOOP
repeat 
    char.Humanoid:Move(Vector3.new(0,0,-1),true)
    task.wait(1/60)
    nim=nim+1
until nim==3
RunService.RenderStepped:Connect(function(deltaTime: number)
    	local function Alpha(n)
		return math.clamp(n*deltaTime*60,0,1)
	end
  hum.CameraOffset =  hum.CameraOffset:Lerp((hrp.CFrame*cf(0,1.5,0)):PointToObjectSpace(h.Position),Alpha(.15))
	if IsAllowedState  and dancing == false then
		local HeadPosition = Head.Position
		if Neck then
			local MousePos = PlayerMouse.Hit.Position
			local TranslationVector = (HeadPosition - MousePos).Unit
			local Pitch = atan(TranslationVector.Y)
			local Yaw = TranslationVector:Cross(Torso.CFrame.LookVector).Y
			local Roll = atan(Yaw)
			
			local NeckCFrame
			if IsR6 then
				NeckCFrame = CFrame.Angles(Pitch, 0, Yaw)
			else
				NeckCFrame = CFrame.Angles(-Pitch * 0.5, Yaw, -Roll * 0.5)				
				local waistCFrame = CFrame.Angles(-Pitch * 0.5, Yaw * 0.5, 0)
				Waist.C0 = Waist.C0:Lerp(WaistOriginC0 * waistCFrame, updatesPerSecond * deltaTime)
			end			
			Neck.C0 = Neck.C0:Lerp(NeckOriginC0 * NeckCFrame, updatesPerSecond * deltaTime)
		end
    elseif dancing == true then 
        Neck.C0 = oldC0N
	end	
if char.Humanoid.MoveDirection == Vector3.new(0,0,0) then 
    walking = false 
    idle = true 
else 
    walking = true 
    idle = false 
end
end)
--sonixery was here
--yes me mod it ez
